# Features Avanc√©es & Guide de D√©veloppement

## üîß Architecture de l'Application

### Structure des Donn√©es

```typescript
// Types principaux d√©finis dans src/types/index.ts
DataSource     // Source de donn√©es (CSV, Excel, Supabase)
QueryResult    // R√©sultats d'une requ√™te
Message        // Messages du chat
Anomaly        // Anomalies d√©tect√©es
```

### Flux de Donn√©es

```
User Input
    ‚Üì
Chat Hook (useChat)
    ‚Üì
SQL Engine (parseNaturalLanguageQuery)
    ‚Üì
Data Processing (executeQuery)
    ‚Üì
Response Generation
    ‚Üì
Display in UI
```

## üöÄ Extensibilit√©

### Ajouter un nouveau type de graphique

1. Modifier `src/components/Chart.tsx` :

```typescript
{type === 'yourgraph' && (
  <YourGraphComponent data={data} {...props} />
)}
```

2. Ajouter le type dans `src/types/index.ts` :

```typescript
type: "bar" | "line" | "pie" | "scatter" | "yourgraph"
```

### Ajouter une source de donn√©es personnalis√©e

1. Cr√©er une fonction de parsing dans `src/lib/data-parser.ts`
2. Ajouter un composant dans `src/components/`
3. Int√©grer dans le hook `useDataSource`

### Am√©liorer le moteur SQL

Modifier `src/lib/sql-engine.ts` pour ajouter :

```typescript
// Nouvelles op√©rations
case "median":
case "percentile":
case "groupby":
  // Impl√©mentation
```

### Am√©liorer la d√©tection d'anomalies

Ajouter de nouveaux d√©tecteurs dans `src/lib/anomaly-detection.ts` :

```typescript
export function detectSeasonality(data: DataPoint[], field: string): Anomaly[] {
  // Logique de d√©tection saisonni√®re
}

export function detectTrends(data: DataPoint[], field: string): Anomaly[] {
  // Logique de d√©tection de tendances
}
```

## ü§ñ Int√©gration IA R√©elle (Optionnel)

### Utiliser OpenAI pour le parsing naturel

```typescript
import { Configuration, OpenAIApi } from "openai";

export async function parseWithGPT(question: string) {
  const config = new Configuration({
    apiKey: process.env.OPENAI_API_KEY,
  });
  const openai = new OpenAIApi(config);

  const response = await openai.createChatCompletion({
    model: "gpt-3.5-turbo",
    messages: [
      {
        role: "user",
        content: `Convertis cette question en objet JSON: ${question}`,
      },
    ],
  });

  return JSON.parse(response.data.choices[0].message?.content || "{}");
}
```

### Configuration OpenAI

1. Cr√©er un compte sur [openai.com](https://openai.com)
2. R√©cup√©rer votre cl√© API
3. Ajouter √† `.env.local` :
   ```
   OPENAI_API_KEY=sk-...
   ```

## üóÑÔ∏è Int√©gration Supabase Compl√®te

### Configuration

1. Cr√©er un compte Supabase
2. Cr√©er une table :

```sql
CREATE TABLE sales (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  date TIMESTAMP NOT NULL,
  region TEXT NOT NULL,
  ventes BIGINT NOT NULL,
  clients BIGINT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

3. Ajouter des donn√©es
4. R√©cup√©rer les cl√©s d'API

### Utiliser Supabase dans le code

```typescript
import { createClient } from "@supabase/supabase-js";

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
);

// Requ√™te
const { data } = await supabase.from("sales").select("*");
```

## üìà Optimisations de Performance

### Virtualisation des Listes

Pour les grandes tables, utiliser `react-window` :

```bash
npm install react-window
```

```typescript
import { FixedSizeList as List } from "react-window";

<List height={600} itemCount={10000} itemSize={35} width="100%">
  {Row}
</List>
```

### Code Splitting

Next.js fait d√©j√† du code splitting automatique, mais vous pouvez optimiser avec :

```typescript
import dynamic from "next/dynamic";

const HeavyChart = dynamic(() => import("@/components/Chart"), {
  loading: () => <div>Chargement...</div>,
});
```

### Caching des R√©sultats

```typescript
import { useMemo } from "react";

const memoizedResults = useMemo(() => {
  return executeQuery(data, operation);
}, [data, operation]);
```

## üß™ Tests

### Setup Jest

```bash
npm install --save-dev jest @testing-library/react @testing-library/jest-dom
```

### Exemple de test

```typescript
// src/lib/__tests__/sql-engine.test.ts
import { executeQuery } from "@/lib/sql-engine";

describe("SQL Engine", () => {
  it("should execute count query", () => {
    const data = [{ id: 1 }, { id: 2 }];
    const result = executeQuery(data, "count");
    expect(result.rowCount).toBe(2);
  });
});
```

## üìö API Routes (optionnel)

Cr√©er des endpoints pour les op√©rations c√¥t√© serveur :

```typescript
// src/app/api/analyze/route.ts
export async function POST(request: Request) {
  const { question, data } = await request.json();
  
  const result = executeQuery(data, "select");
  
  return Response.json(result);
}
```

## üîê S√©curit√©

### Validation des uploads

```typescript
const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
const ALLOWED_TYPES = ["text/csv", "application/vnd.ms-excel"];

if (file.size > MAX_FILE_SIZE) {
  throw new Error("Fichier trop volumineux");
}

if (!ALLOWED_TYPES.includes(file.type)) {
  throw new Error("Type de fichier non autoris√©");
}
```

### Variables sensibles

- Ne jamais commit `.env.local`
- Utiliser les Environment Variables de Vercel
- Utiliser les cl√©s d'API restreintes (anon key pour Supabase)

## üìä Analytics

### Vercel Analytics

Int√©gration automatique si d√©ploy√© sur Vercel.

### Google Analytics (optionnel)

```bash
npm install @react-google-analytics/core
```

```typescript
import { Analytics } from "@react-google-analytics/core";

export default function App() {
  return (
    <>
      <Analytics gtagId="G-XXXXXXXXXX" />
      {/* ... */}
    </>
  );
}
```

## üé® Consid√©rations de Design

### Accessibilit√© (A11y)

- Utiliser les attributs ARIA
- Tester avec les lecteurs d'√©cran
- V√©rifier les contrastes de couleur

### Responsivit√©

- Mobile-first approach
- Tester sur tous les appareils
- Utiliser les breakpoints Tailwind

## üêõ Debugging

### React DevTools

```bash
# Extension Chrome/Firefox disponible
```

### VS Code Debugger

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/next",
      "args": ["dev"],
      "skipFiles": ["<node_internals>/**"],
      "console": "integratedTerminal"
    }
  ]
}
```

## üìù Documentation de Composants

### Format standardis√©

```typescript
/**
 * ChartComponent - Affiche des graphiques interactifs
 * 
 * @component
 * @example
 * <Chart 
 *   type="bar" 
 *   data={dataset}
 *   xAxis="region"
 *   yAxis="sales"
 *   title="Ventes par r√©gion"
 * />
 * 
 * @param {ChartProps} props
 * @returns {React.ReactElement}
 */
export function Chart(props: ChartProps) {
  // Implementation
}
```

---

Pour plus d'aide, consultez la [documentation Next.js](https://nextjs.org/docs).
